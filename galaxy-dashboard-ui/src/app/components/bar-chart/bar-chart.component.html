<!-- bar-chart.component.html -->
<!-- Ultra-Premium Bar Chart Widget - Notion/Linear Style -->
<div class="premium-bar-chart-widget group h-full relative overflow-hidden">
  
  <!-- Glass morphism background with premium gradients -->
  <div class="absolute inset-0 bg-gradient-to-br from-white/95 via-slate-50/90 to-purple-50/95 backdrop-blur-2xl"></div>
  <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,rgba(147,51,234,0.06),transparent_50%)]"></div>
  <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_right,rgba(99,102,241,0.04),transparent_50%)]"></div>
  <div class="absolute inset-0 border border-gray-200/60 rounded-3xl"></div>
  <div class="absolute inset-0 border border-white/60 rounded-3xl"></div>
  
  <!-- Main content container -->
  <div class="relative z-10 h-full flex flex-col p-4">
    <!-- Height control wrapper -->
    <div class="h-full flex flex-col min-h-0">
    
    <!-- Header Section with Premium Design -->
    <div class="flex items-center justify-between mb-3 flex-shrink-0"> <!-- Reduced margin-bottom -->
      <div class="flex items-center space-x-4">
        <!-- Premium title section -->
        <div class="flex items-center space-x-3">
          <div class="w-1 h-8 bg-gradient-to-b from-purple-500 via-indigo-500 to-blue-500 rounded-full shadow-lg"></div>
          <div>
            <h3 class="text-xl font-bold bg-gradient-to-r from-gray-900 via-gray-800 to-gray-700 bg-clip-text text-transparent leading-tight">{{title}}</h3>
            <div class="flex items-center space-x-2 mt-1">
              <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse shadow-sm"></div>
              <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Live Insights</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Premium controls section -->
      <div class="flex items-center space-x-3">
        <!-- Time range selector -->
        <div class="relative" *ngIf="!isRefreshing">
          <select 
            [(ngModel)]="selectedTimeFrame" 
            (ngModelChange)="onTimeFrameChange($event)"
            class="no-drag appearance-none bg-white/80 border border-gray-200/80 rounded-2xl px-5 py-2.5 pr-10 text-sm font-semibold text-gray-700 hover:bg-white hover:border-purple-300/50 focus:outline-none focus:ring-2 focus:ring-purple-400/30 focus:border-purple-400/60 transition-all duration-300 cursor-pointer shadow-sm hover:shadow-lg">
            <option value="7d">Last 7 days</option>
            <option value="1w">Last week</option>
            <option value="1m">Last month</option>
            <option value="3m">Last 3 months</option>
            <option value="6m">Last 6 months</option>
            <option value="1y">Last year</option>
            <option value="all">All time</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
        </div>
        
        <!-- Premium Log Scale Toggle -->
        <div class="flex items-center space-x-3 bg-white/80 border border-gray-200/80 rounded-2xl px-4 py-2.5 hover:bg-white hover:border-purple-300/50 transition-all duration-300 shadow-sm hover:shadow-lg">
          <span class="text-sm font-semibold text-gray-700">Log Scale</span>
          <button 
            (click)="onLogScaleToggle(!isLogScale)"
            [class]="isLogScale ? 'bg-gradient-to-r from-purple-500 to-indigo-500' : 'bg-gray-300'"
            class="relative inline-flex h-6 w-11 items-center rounded-full transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-purple-400/30 hover:scale-105">
            <span [class]="isLogScale ? 'translate-x-6' : 'translate-x-1'" 
                  class="inline-block h-4 w-4 transform rounded-full bg-white transition-all duration-300 shadow-lg"></span>
          </button>
        </div>
        
        <!-- Widget actions -->
        <app-widget-header
          [title]="''"
          [isLoading]="isRefreshing"
          [dashboardWidgetId]="data?.dashboardWidgetId"
          [widgetData]="getExpandedData()"
          (onRefresh)="handleRefresh()"
          (onExpand)="handleExpand($event)"
          (onClose)="handleClose($event)"
          class="premium-widget-actions">
        </app-widget-header>
      </div>
    </div>

    <!-- Ultra-Modern Responsive Stats Display - Made more compact -->
    <div *ngIf="!isRefreshing && chartStatistics" class="responsive-stats-container flex-shrink-0 mb-2"> <!-- Added margin-bottom -->
      <div class="stats-grid-responsive">
        
        <!-- Ultra-Modern Total Card -->
        <div class="modern-stat-card group/stat" [attr.data-type]="'total'">
          <div class="stat-card-bg bg-gradient-to-br from-blue-500/10 via-indigo-500/5 to-purple-500/10"></div>
          <div class="stat-card-content">
            <!-- Icon -->
            <div class="stat-icon bg-gradient-to-br from-blue-500 to-indigo-600">
              <svg class="stat-icon-svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </div>
            <!-- Content -->
            <div class="stat-content">
              <div class="stat-label">Total Revenue</div>
              <div class="stat-value">{{chartStatistics.total | number:'1.0-0'}}</div>
              <div class="stat-meta">{{isLogScale ? 'Log Scale' : 'Linear Scale'}}</div> <!-- Shortened text -->
            </div>
            <!-- Trend indicator -->
            <div class="stat-trend positive">
              <div class="trend-dot"></div>
            </div>
          </div>
        </div>

        <!-- Ultra-Modern Average Card -->
        <div class="modern-stat-card group/stat" [attr.data-type]="'average'">
          <div class="stat-card-bg bg-gradient-to-br from-emerald-500/10 via-teal-500/5 to-green-500/10"></div>
          <div class="stat-card-content">
            <!-- Icon -->
            <div class="stat-icon bg-gradient-to-br from-emerald-500 to-teal-600">
              <svg class="stat-icon-svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
            </div>
            <!-- Content -->
            <div class="stat-content">
              <div class="stat-label">Average</div>
              <div class="stat-value text-emerald-600">{{chartStatistics.average | number:'1.0-0'}}</div>
              <div class="stat-meta"></div>
            </div>
            <!-- Trend indicator -->
            <div class="stat-trend neutral">
              <div class="trend-dot"></div>
            </div>
          </div>
        </div>

        <!-- Ultra-Modern Growth Card -->
        <div class="modern-stat-card group/stat" [attr.data-type]="'top-category'">
  <div class="stat-card-bg bg-gradient-to-br from-purple-500/10 via-indigo-500/5 to-blue-500/10"></div>
  <div class="stat-card-content">
    <div class="stat-icon bg-gradient-to-br from-orange-500 to-red-600">
      <svg class="stat-icon-svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-label">Top Category</div>
      <div class="stat-value text-indigo-600">{{chartStatistics.topCategory}}</div>
      <div class="stat-meta">Highest value</div>
    </div>
    <div class="stat-trend positive">
      <div class="trend-dot"></div>
    </div>
  </div>
</div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isRefreshing" class="flex-1 flex items-center justify-center min-h-[300px]">
      <div class="text-center">
        <div class="relative inline-flex items-center justify-center w-20 h-20 mb-6">
          <div class="absolute inset-0 bg-gradient-to-br from-purple-500 via-indigo-500 to-blue-500 rounded-3xl animate-pulse shadow-2xl"></div>
          <div class="relative w-10 h-10 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
        </div>
        <p class="text-base font-semibold text-gray-700 mb-2">Processing data</p>
        <p class="text-sm text-gray-500">Calculating insights...</p>
      </div>
    </div>

    <!-- Ultra-Premium Chart Container with height constraint - Now gets more space -->
    <div *ngIf="!isRefreshing" class="flex-1 relative chart-container-responsive min-h-0" style="min-height: 200px;">
      <!-- Chart backdrop with subtle gradient -->
      <div class="absolute inset-4 bg-gradient-to-br from-gray-50/30 to-purple-50/20 rounded-2xl"></div>
      
      <!-- Main chart canvas -->
      <canvas baseChart
              [data]="chartData"
              [options]="chartOptions"
              [type]="'bar'"
              class="premium-bar-canvas relative z-10 w-full h-full rounded-2xl">
      </canvas>
      
      <!-- Premium overlay effects -->
      <div class="absolute inset-0 pointer-events-none rounded-2xl overflow-hidden">
        <!-- Subtle gradient overlay at edges -->
        <div class="absolute top-0 left-0 right-0 h-8 bg-gradient-to-b from-white/40 to-transparent"></div>
        <div class="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-white/40 to-transparent"></div>
        <div class="absolute top-0 bottom-0 left-0 w-8 bg-gradient-to-r from-white/40 to-transparent"></div>
        <div class="absolute top-0 bottom-0 right-0 w-8 bg-gradient-to-l from-white/40 to-transparent"></div>
        
        <!-- Premium glow effect -->
        <div class="absolute inset-0 border border-white/20 rounded-2xl"></div>
      </div>
    </div>
    
    </div>
    
    <!-- Premium hover glow effect -->
    <div class="absolute inset-0 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none bg-gradient-to-br from-purple-100/10 via-transparent to-indigo-100/10"></div>
  </div>
</div>