<div class="dashboard-selector-container" #selectorContainer>
  <div class="selector-main">
    
    <div class="selector-content">
      <button class="selector-trigger" (click)="toggleExpanded()">
        <div class="dashboard-name-container">
          <button class="favorite-star-button" 
                  *ngIf="currentDashboard" 
                  (click)="toggleCurrentDashboardFavorite($event)"
                  [class.favorited]="currentDashboard.isFavorite">
            <svg class="favorite-star-icon" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          </button>
          <span class="current-name">{{ currentDashboard?.name || 'Select dashboard' }}</span>
        </div>
        <div class="chevron-container">
          <svg class="chevron-icon" [class.expanded]="isExpanded" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </div>
      </button>

      <div class="selector-actions" *ngIf="showOptionsButton">
        <button class="options-btn" (click)="toggleActionMenu($event)" aria-label="Dashboard options">
          <svg class="kebab-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
          </svg>
        </button>

        <div class="options-menu" *ngIf="isActionMenuOpen" (click)="$event.stopPropagation()">
          <button class="option-item" (click)="openDashboardDetails()">
            <i class="fas fa-info-circle"></i>
            Dashboard details
          </button>
          <button class="option-item" (click)="editDashboard()">
            <i class="fas fa-edit"></i>
            Edit dashboard
          </button>
          <button class="option-item" (click)="setAsDefault()">
            <i class="fas fa-star"></i>
            Set as default
          </button>
          <button class="option-item" (click)="addWidget()">
            <i class="fas fa-plus"></i>
            Add Widget
          </button>
          <button class="option-item danger" (click)="deleteDashboard()">
            <i class="fas fa-trash"></i>
            Delete dashboard
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="selector-dropdown" 
       [class.expanded]="isExpanded"
       [@slideInOut]="isExpanded ? '*' : 'void'">
    
    <div class="selector-header">
      <div class="search-container">
        <svg class="search-icon" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
        </svg>
        <input #searchInput
               type="text" 
               placeholder="Search dashboards..."
               [(ngModel)]="searchQuery"
               (input)="filterDashboards()"
               class="search-input">
      </div>

      <div class="filter-tabs">
        <button class="filter-tab" [class.active]="selectedCategory === 'all'" (click)="applyCategory('all')">
          ALL
        </button>
        <button class="filter-tab" [class.active]="selectedCategory === 'favorites'" (click)="applyCategory('favorites')">
          FAVORITES
        </button>
        <button class="filter-tab" [class.active]="selectedCategory === 'personal'" (click)="applyCategory('personal')">
          PRIVATE
        </button>
        <button class="filter-tab" [class.active]="selectedCategory === 'shared'" (click)="applyCategory('shared')">
          SHARED
        </button>
        <button class="filter-tab" [class.active]="selectedCategory === 'default'" (click)="applyCategory('default')">
          GLOBAL
        </button>
      </div>
    </div>

    <div class="list-container" *ngIf="!isLoading">
      <div class="dashboard-item" 
           *ngFor="let dashboard of filteredDashboards"
           [class.selected]="dashboard.id === currentDashboard?.id"
           (click)="selectDashboard(dashboard)"
           [@scaleIn]>
        
        <div class="item-main">
          <div class="item-selection-indicator">
            <svg class="check-icon" *ngIf="dashboard.id === currentDashboard?.id" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="item-content">
            <div class="item-header">
              <h3 class="item-name">{{ dashboard.name }}</h3>
              <div class="item-category">
                {{ displayCategoryName(dashboard.category) }}
              </div>
            </div>
            <div class="item-meta">
              <span class="widget-count">{{ dashboard.widgetCount }} widgets</span>
              <span class="last-accessed">{{ dashboard.lastAccessed | date:'MMM d' }}</span>
            </div>
          </div>
        </div>

        <div class="item-actions">
          <button class="favorite-btn" 
                  [class.favorited]="dashboard.isFavorite"
                  (click)="toggleFavorite(dashboard, $event)">
            <svg class="star-icon" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="loading-state" *ngIf="isLoading">
      <div class="loading-spinner"></div>
      <p>Loading dashboards...</p>
    </div>

    <div class="empty-state" *ngIf="!isLoading && filteredDashboards.length === 0">
      <div class="empty-icon">ðŸ“‚</div>
      <h3>No dashboards found</h3>
      <p>Try adjusting your search or filters</p>
    </div>
  </div>
</div>