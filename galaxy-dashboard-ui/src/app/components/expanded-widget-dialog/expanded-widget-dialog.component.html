<div class="expanded-widget-dialog">
  <!-- Dialog Header -->
  <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
    <div class="flex items-center space-x-4">
      <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
        <i class="fas fa-chart-line text-blue-600"></i>
      </div>
      <div>
        <h2 class="text-xl font-semibold text-gray-900">{{ data.title || 'Widget Details' }}</h2>
<p class="text-sm text-gray-600 mt-1">{{ data.description || 'Detailed view with additional information' }}</p>
      </div>
    </div>
    <div class="flex items-center space-x-2">
      <button 
        (click)="onRefresh()"
        class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-100 rounded-lg transition-all duration-200"
        title="Refresh Data">
        <i class="fas fa-sync-alt"></i>
      </button>
      <button 
        (click)="onClose()"
        class="p-2 text-gray-500 hover:text-red-600 hover:bg-red-100 rounded-lg transition-all duration-200"
        title="Close">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- Dialog Content -->
  <div class="p-6 max-h-[80vh] overflow-y-auto">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- Main Chart Area -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <div class="chart-container" style="height: 400px;">
            
            <!-- KPI Card -->
            <app-kpi-card
              *ngIf="isKpiCard()"
              [data]="data.data">
            </app-kpi-card>
            
            <!-- Line Chart -->
            <app-line-chart
              *ngIf="getChartComponent() === 'line-chart'"
              [data]="data.data"
              [title]="data.title || 'Line Chart'"
              [height]="'400px'">
            </app-line-chart>
            
            <!-- Bar Chart -->
            <app-bar-chart
              *ngIf="getChartComponent() === 'bar-chart'"
              [data]="data.data"
              [title]="data.title || 'Bar Chart'">
            </app-bar-chart>
            
            <!-- Pie Chart -->
            <app-pie-chart
              *ngIf="getChartComponent() === 'pie-chart'"
              [data]="data.data"
              [title]="data.title || 'Pie Chart'"
              [showLegend]="false">
            </app-pie-chart>
            
            <!-- Doughnut Chart -->
            <app-doughnut-chart
              *ngIf="getChartComponent() === 'doughnut-chart'"
              [data]="data.data"
              [title]="data.title || 'Doughnut Chart'"
              [showLegend]="false">
            </app-doughnut-chart>
            
            <!-- Area Chart -->
            <app-area-chart
              *ngIf="getChartComponent() === 'area-chart'"
              [data]="data.data"
              [title]="data.title || 'Area Chart'">
            </app-area-chart>
            
            <!-- Horizontal Bar Chart -->
            <app-horizontal-bar-chart
              *ngIf="getChartComponent() === 'horizontal-bar-chart'"
              [data]="data.data"
              [title]="data.title || 'Horizontal Bar Chart'">
            </app-horizontal-bar-chart>
            
            <!-- Radar Chart -->
            <app-radar-chart
              *ngIf="getChartComponent() === 'radar-chart'"
              [data]="data.data"
              [title]="data.title || 'Radar Chart'">
            </app-radar-chart>
            
            <!-- Data Table (Full Width when expanded) -->
            <app-data-table
              *ngIf="isTableChart()"
              [data]="data.data">
            </app-data-table>
            
          </div>
        </div>
      </div>

      <!-- Sidebar with Details and Legend -->
      <div class="lg:col-span-1 space-y-6" *ngIf="!isTableChart()">
        
        <!-- Widget Information -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-info-circle text-blue-500 mr-2"></i>
            Widget Information
          </h3>
          
          <div class="space-y-3">
            <div>
              <span class="text-sm font-medium text-gray-600">Chart Type:</span>
              <span class="text-sm text-gray-900 ml-2 capitalize">{{ getWidgetMetrics()?.chartType?.replace('-', ' ') }}</span>
            </div>
            <div>
              <span class="text-sm font-medium text-gray-600">Data Points:</span>
              <span class="text-sm text-gray-900 ml-2">{{ getWidgetMetrics()?.dataPoints }}</span>
            </div>
            <div *ngIf="getWidgetMetrics()?.datasets">
              <span class="text-sm font-medium text-gray-600">Datasets:</span>
              <span class="text-sm text-gray-900 ml-2">{{ getWidgetMetrics()?.datasets }}</span>
            </div>
            <div *ngIf="getWidgetMetrics()?.totalValue">
              <span class="text-sm font-medium text-gray-600">Total Value:</span>
              <span class="text-sm text-gray-900 ml-2">{{ formatValue(getWidgetMetrics()?.totalValue) }}</span>
            </div>
            <div>
              <span class="text-sm font-medium text-gray-600">Last Updated:</span>
              <span class="text-sm text-gray-900 ml-2">{{ getWidgetMetrics()?.lastUpdated }}</span>
            </div>
          </div>
        </div>

        <!-- Legend for Pie/Donut Charts -->
        <div *ngIf="isPieOrDonutChart() && getChartLegendData().length > 0" 
             class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-list text-purple-500 mr-2"></i>
            Data Breakdown
          </h3>
          
          <div class="space-y-3 max-h-80 overflow-y-auto">
            <div *ngFor="let item of getChartLegendData()" 
                 class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors duration-200">
              <div class="flex items-center space-x-3">
                <div class="w-4 h-4 rounded-full flex-shrink-0" 
                     [style.background-color]="item.color"></div>
                <span class="text-sm font-medium text-gray-900 truncate">{{ item.label }}</span>
              </div>
              <div class="text-right">
                <div class="text-sm font-semibold text-gray-900">{{ formatValue(item.value) }}</div>
                <div class="text-xs text-gray-500">{{ item.percentage }}%</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart Statistics for Line/Bar Charts -->
        <div *ngIf="isLineOrBarChart()" 
             class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-chart-bar text-green-500 mr-2"></i>
            Chart Statistics
          </h3>
          
          <div class="space-y-3">
            <div class="p-3 bg-blue-50 rounded-lg">
              <div class="text-xs text-blue-600 font-medium uppercase tracking-wide">Performance</div>
              <div class="text-sm text-blue-900 mt-1">Interactive chart with hover details</div>
            </div>
            <div class="p-3 bg-green-50 rounded-lg">
              <div class="text-xs text-green-600 font-medium uppercase tracking-wide">Data Quality</div>
              <div class="text-sm text-green-900 mt-1">Real-time data synchronization</div>
            </div>
            <div class="p-3 bg-purple-50 rounded-lg">
              <div class="text-xs text-purple-600 font-medium uppercase tracking-wide">Visualization</div>
              <div class="text-sm text-purple-900 mt-1">Optimized for clarity and insights</div>
            </div>
          </div>
        </div>

      </div>
      
      <!-- Full width for table -->
      <div *ngIf="isTableChart()" class="lg:col-span-3">
        <!-- Table is already rendered above in main chart area -->
      </div>
      
    </div>
  </div>
</div>
